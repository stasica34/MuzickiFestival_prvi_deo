CREATE TABLE DOGADJAJ
(
    "ID" NUMBER,
    "NAZIV" VARCHAR2(100 BYTE),
    "TIP" VARCHAR2(50 BYTE),
    "OPIS" VARCHAR2(200 BYTE),
    "DATUM_VREME_POCETKA" DATE,
    "DATUM_VREME_KRAJA" DATE,
    "LOKACIJA_ID" NUMBER
);

//sekvence i trigeri//
CREATE SEQUENCE DOGADJAJ_PK START WITH 1 INCREMENT BY 1 NOCACHE;

create or replace TRIGGER DOGADJAJ_AUTO_PK
BEFORE INSERT
ON Dogadjaj
REFERENCING NEW AS NEW
FOR EACH ROW
BEGIN
  SELECT Dogadjaj_PK.NEXTVAL INTO :NEW.ID FROM dual;
END;

//keys i null//
ALTER TABLE DOGADJAJ MODIFY ("LOKACIJA_ID" NOT NULL);
ALTER TABLE DOGADJAJ MODIFY ("DATUM_VREME_KRAJA" NOT NULL);
ALTER TABLE DOGADJAJ MODIFY ("DATUM_VREME_POCETKA" NOT NULL);
ALTER TABLE DOGADJAJ MODIFY ("TIP" NOT NULL);
ALTER TABLE DOGADJAJ MODIFY ("NAZIV" NOT NULL);
ALTER TABLE DOGADJAJ ADD CONSTRAINT "PK_DOGADJAJ" PRIMARY KEY ("ID");
ALTER TABLE DOGADJAJ ADD CONSTRAINT "UQ_DOGADJAJ_NAZIV_LOKACIJA" UNIQUE ("NAZIV", "DATUM_VREME_POCETKA", "LOKACIJA_ID") USING INDEX UQ_DOGADJAJ_NAZIV_LOKACIJA;
ALTER TABLE DOGADJAJ ADD CONSTRAINT "FK_DOGADJAJ_LOKACIJA" FOREIGN KEY ("LOKACIJA_ID")
    REFERENCES LOKACIJA ("ID") ON DELETE CASCADE ENABLE;


//constraints//

ALTER TABLE DOGADJAJ ADD CONSTRAINT "CHK_DOGADJAJ_TIP" CHECK ("TIP" IN ('Muzicki nastup', 'Radionica', 'Interaktivni sadrzaj', 'Drugi'));
ALTER TABLE DOGADJAJ ADD CONSTRAINT "CHK_DOGADJAJ_DATUMI" CHECK (DATUM_VREME_KRAJA > DATUM_VREME_POCETKA);
ALTER TABLE DOGADJAJ ADD CONSTRAINT "CHK_DOGADJAJ_OPIS" CHECK (
    OPIS IS NULL OR REGEXP_LIKE(TRIM(OPIS), '^[A-Za-zčćšđžČĆŠĐŽ]+([ ][A-Za-zčćšđžČĆŠĐŽ]+)*$')
);
ALTER TABLE "S19184"."DOGADJAJ" 
ADD CONSTRAINT "CHK_DOGADJAJ_NAZIV" 
CHECK (
    LENGTH(TRIM(NAZIV)) > 0 AND 
    REGEXP_LIKE(TRIM(NAZIV), '^[A-Za-zčćšđžČĆŠĐŽ\s]+$')
) ENABLE;
