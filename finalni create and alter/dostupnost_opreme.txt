CREATE TABLE DOSTUPNOST_OPREME
(
    "NAZIV" VARCHAR2(20 BYTE),
    "LOKACIJA_ID" NUMBER,
    "ID" NUMBER
)

//sekvence i trigeri//

CREATE SEQUENCE DOSTUPNOST_OPREME_PK START WITH 1 INCREMENT BY 1 NOCACHE;

create or replace TRIGGER "S19184"."DOSTUPNOST_OPREME_AUTO_PK" 
before insert on "DOSTUPNOST_OPREME"
referencing new as new
for each row
begin
    select DOSTUPNOST_OPREME_PK.nextval
    into: new.ID
    from dual;
end;

//keys i null//

ALTER TABLE DOSTUPNOST_OPREME MODIFY ("NAZIV" NOT NULL);
ALTER TABLE DOSTUPNOST_OPREME MODIFY ("LOKACIJA_ID" NOT NULL);
ALTER TABLE DOSTUPNOST_OPREME MODIFY ("ID" NOT NULL);
ALTER TABLE DOSTUPNOST_OPREME ADD CONSTRAINT "DOSTUPNOST_OPREME_PK" PRIMARY KEY ("ID");
ALTER TABLE DOSTUPNOST_OPREME ADD CONSTRAINT "DOSTUPNOST_OPREME_FK1" FOREIGN KEY ("LOKACIJA_ID")
    REFERENCES LOKACIJA ("ID") ON DELETE CASCADE ENABLE;

//constraint//

ALTER TABLE DOSTUPNOST_OPREME ADD CONSTRAINT "CHK_DOSTUPNOST_OPREME_NAZIV" CHECK (
    LENGTH(TRIM(NAZIV)) > 0 -- Sprečava samo razmake
    AND REGEXP_LIKE(
        NAZIV,
        '^[A-Za-zŠšĐđČčĆćŽž][A-Za-zŠšĐđČčĆćŽž0-9]*( [A-Za-zŠšĐđČčĆćŽž0-9]+)*$'
    )
);
ALTER TABLE DOSTUPNOST_OPREME ADD CONSTRAINT "UQ_OPREMA_NAZIV_LOK" UNIQUE ("NAZIV", "LOKACIJA_ID");


