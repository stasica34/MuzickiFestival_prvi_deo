CREATE TABLE KONTAKT_PODACI_MENADZERSKE
(
    "TIP_KONTAKTA" VARCHAR2(20 BYTE),
    "VREDNOST" VARCHAR2(20 BYTE),
    "MENADZERSKA_AGENCIJA_ID" NUMBER,
    "ID" NUMBER
)

//sekvence i trigeri//

CREATE SEQUENCE KONTAKT_PODACI_MENADZERSKE_PK START WITH 1 INCREMENT BY 1 NOCACHE;

CREATE OR REPLACE TRIGGER KONTAKT_PODACI__AUTO_PK
BEFORE INSERT ON KONTAKT_PODACI_MENADZERSKE
REFERENCING NEW AS NEW
FOR EACH ROW
BEGIN
    IF :NEW.ID IS NULL THEN
        SELECT KONTAKT_PODACI_MENADZERSKE_PK.NEXTVAL
        INTO :NEW.ID
        FROM DUAL;
    END IF;
END;

//keys i null//

ALTER TABLE KONTAKT_PODACI_MENADZERSKE MODIFY ("TIP_KONTAKTA" NOT NULL);
ALTER TABLE KONTAKT_PODACI_MENADZERSKE MODIFY ("VREDNOST" NOT NULL);
ALTER TABLE KONTAKT_PODACI_MENADZERSKE MODIFY ("MENADZERSKA_AGENCIJA_ID" NOT NULL);
ALTER TABLE KONTAKT_PODACI_MENADZERSKE MODIFY ("ID" NOT NULL);

ALTER TABLE KONTAKT_PODACI_MENADZERSKE ADD CONSTRAINT "KONTAKT_PODACI_MENADZERSKE_PK" PRIMARY KEY ("ID");

//ref constraint//

ALTER TABLE KONTAKT_PODACI_MENADZERSKE ADD CONSTRAINT "KONTKAT_PODACI_MENADZERSK_FK1" FOREIGN KEY ("MENADZERSKA_AGENCIJA_ID")
    REFERENCES MENADZERSKA_AGENCIJA ("ID") ON DELETE CASCADE;

//constraints//

ALTER TABLE KONTAKT_PODACI_MENADZERSKE ADD CONSTRAINT "CK_TIP_KONTAKTA" CHECK (TIP_KONTAKTA IN ('EMAIL','TELEFON'));

ALTER TABLE KONTAKT_PODACI_MENADZERSKE ADD CONSTRAINT "CHK_TELEFON_EMAIL" CHECK (
    LENGTH(TRIM(VREDNOST)) > 0 
    AND (
        (TIP_KONTAKTA = 'TELEFON' AND REGEXP_LIKE(TRIM(VREDNOST), '^[0-9]{10}$'))
        OR
        (TIP_KONTAKTA = 'EMAIL' AND REGEXP_LIKE(TRIM(VREDNOST), '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$'))
    )
);
