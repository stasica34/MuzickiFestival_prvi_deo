CREATE TABLE IZVODJAC
(
    "ID" NUMBER,
    "IME" VARCHAR2(50 BYTE),
    "TIP_IZVODJACA" VARCHAR2(20 BYTE),
    "ZANR" VARCHAR2(50 BYTE),
    "DRZAVA_POREKLA" VARCHAR2(50 BYTE),
    "EMAIL" VARCHAR2(100 BYTE),
    "TELEFON" VARCHAR2(20 BYTE),
    "KONTAKT_OSOBA" VARCHAR2(100 BYTE),
    "MENADZERSKA_AGENCIJA_ID" NUMBER
)

//sekvence//

CREATE SEQUENCE IZVODJAC_PK START WITH 1 INCREMENT BY 1 NOCACHE;

//keys i null//

ALTER TABLE IZVODJAC MODIFY ("IME" NOT NULL);
ALTER TABLE IZVODJAC MODIFY ("TIP_IZVODJACA" NOT NULL);
ALTER TABLE IZVODJAC MODIFY ("ZANR" NOT NULL);
ALTER TABLE IZVODJAC MODIFY ("DRZAVA_POREKLA" NOT NULL);
ALTER TABLE IZVODJAC MODIFY ("EMAIL" NOT NULL);

ALTER TABLE IZVODJAC ADD CONSTRAINT "PK_IZVODJAC" PRIMARY KEY ("ID");
ALTER TABLE IZVODJAC ADD CONSTRAINT "UK_IZVODJAC_EMAIL" UNIQUE ("EMAIL");
ALTER TABLE IZVODJAC ADD CONSTRAINT "UK_IZVODJAC_TELEFON" UNIQUE ("TELEFON");

ALTER TABLE IZVODJAC ADD CONSTRAINT "FK_IZVODJAC_MENADZERSKA_A" FOREIGN KEY ("MENADZERSKA_AGENCIJA_ID")
    REFERENCES MENADZERSKA_AGENCIJA("ID") ON DELETE CASCADE;

//constraints//

ALTER TABLE IZVODJAC ADD CONSTRAINT "CHK_IZVODJAC_ZANR" 
CHECK (REGEXP_LIKE(TRIM(ZANR), '^[A-Za-zĆČŠĐŽćčšđž\s]+$'));

ALTER TABLE IZVODJAC ADD CONSTRAINT "CHK_IZVODJAC_DRZAVA" 
CHECK (REGEXP_LIKE(TRIM(DRZAVA_POREKLA), '^[A-Za-zĆČŠĐŽćčšđž\s]+$'));

ALTER TABLE IZVODJAC ADD CONSTRAINT "CHK_IZVODJAC_KONTAKT" 
CHECK (KONTAKT_OSOBA IS NULL OR LENGTH(TRIM(KONTAKT_OSOBA)) > 0);

ALTER TABLE IZVODJAC ADD CONSTRAINT "CHK_IZVODJAC_TIP" 
CHECK (TIP_IZVODJACA IN ('BEND', 'SOLO_UMETNIK'));

ALTER TABLE IZVODJAC ADD CONSTRAINT "CHK_IZVODJAC_EMAIL" 
CHECK (REGEXP_LIKE(TRIM(EMAIL), '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$'));

ALTER TABLE IZVODJAC ADD CONSTRAINT "CHK_IZVODJAC_TELEFON" 
CHECK (REGEXP_LIKE(TRIM(TELEFON), '^[0-9]{10}$'));
